<div class="card shadow-lg border-0 rounded-xl">
  <div class="card-header bg-primary text-white text-xl font-semibold p-4">Registro Actual</div>
  <div class="card-body p-4">
    <!-- BARRA DE BÚSQUEDA Y BOTÓN -->
    <div class="input-group mb-3 flex flex-col sm:flex-row gap-2">
      <!-- (ngModelChange)="loadPage(0)" ELIMINADO: Ya no usamos paginación tradicional -->
      <input
        type="text"
        class="form-control"
        placeholder="Buscar por RUC o razón social"
        [(ngModel)]="busqueda"
        (keyup.enter)="buscar()"
        name="searchQuery"
      />
      <button class="btn btn-primary" (click)="buscar()" [disabled]="loading()">
        <span *ngIf="!loading()">Buscar</span>
        <span *ngIf="loading()"> <i class="spinner-border spinner-border-sm me-1"></i> Cargando... </span>
      </button>
    </div>

    <!-- Indicador de Carga Global (Usando signal loading()) -->
    <div *ngIf="loading() && itemsFiltrados().length === 0" class="alert alert-info text-center">Cargando primeros resultados...</div>

    <!-- TABLA DE RESULTADOS -->
    <!-- Usamos loading() y itemsFiltrados() -->
    <table
      *ngIf="itemsFiltrados().length > 0"
      class="table table-striped table-hover table-responsive mt-3 border rounded-lg overflow-hidden"
    >
      <thead>
        <tr class="table-dark">
          <th>RUC</th>
          <th>DV</th>
          <th>RAZON SOCIAL</th>
          <th>TIPO</th>
          <th>NRO. TRAMITE</th>
          <th>COMUNICACIÓN</th>
          <th>FECHA DE COMUNICACIÓN</th>
        </tr>
      </thead>
      <tbody>
        <!-- Usamos signal itemsFiltrados() -->
        <tr *ngFor="let item of itemsFiltrados()">
          <td>{{ item.ruc }}</td>
          <td>{{ item.dv }}</td>
          <td>{{ item.razonSocial }}</td>
          <td>{{ item.tipo }}</td>
          <td>{{ item.tramiteId }}</td>
          <td>{{ item.tipoComunicacion }}</td>
          <td>{{ item.fechaComunicacion | date: 'short' }}</td>
        </tr>
      </tbody>
    </table>

    <!-- TOTAL DE ITEMS Y ESTADO -->
    <div *ngIf="totalItems() > 0" class="text-muted text-sm my-3">
      Mostrando {{ itemsFiltrados().length }} de {{ totalItems() }} resultados.
    </div>
    <!-- BOTONES DE EXPORTACIÓN A EXCEL -->
    <button class="btn btn-success mb-3" (click)="exportToExcel()"><i class="fa fa-file-excel"></i> Exportar a Excel Pagina actual</button>
    <button class="btn btn-success mb-3" (click)="exportToExcelAll()">Exportar a excel TODO</button>

    <!-- BOTÓN "CARGAR MÁS" (PAGINACIÓN CONTINUA) -->
    <!-- Usamos signals hasMore() y loading() y llamamos a loadNextPage() -->
    <div class="text-center mt-4">
      <button *ngIf="hasMore() && !loading()" class="btn btn-success btn-lg shadow" (click)="loadNextPage()">
        Cargar Más Resultados ({{ size }} más)
      </button>

      <div *ngIf="loading() && itemsFiltrados().length > 0" class="text-info">
        <i class="spinner-border spinner-border-sm me-1"></i> Cargando página siguiente...
      </div>

      <!-- Mensaje de fin de resultados -->
      <div *ngIf="!hasMore() && itemsFiltrados().length > 0 && !loading()" class="alert alert-secondary mt-3">
        Has cargado todos los resultados.
      </div>
    </div>

    <!-- Mensaje cuando no hay resultados (Usando signal loading()) -->
    <div *ngIf="!loading() && itemsFiltrados().length === 0" class="alert alert-warning text-center mt-3">
      No se encontraron datos para la búsqueda actual.
    </div>
  </div>
</div>
